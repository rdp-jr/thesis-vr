{{> header }}
<div class="container p-5 text-center">
  {{#if error}}
    <div class="alert alert-danger">{{ error }}</div>
  {{/if}}
  
    <h1 class="font-weight-bold">Room Settings</h1>

     <h5> <span class="font-weight-bold">Room ID </span>{{ room_code }} </h5>
        <h5> <span class="font-weight-bold">Secret Key</span> {{ secret_key }} </h5>
    <hr>

    <section id="living-room">
      <h2 class="pb-5">Living Room</h2>

      <form method="POST" action="/room/edit" enctype="multipart/form-data">
        <input type="hidden" name="room_code" value={{room_code}}>
        <input type="hidden" name="secret_key" value={{secret_key}}>

        <div class="form-group">
          <div>
          <h4 class="font-weight-bold mb-0">Television Clip</h4>
          <p class="text-muted">A short snippet from a favorite show or movie</p>
          </div>

          
          <video id="video_1_video" width="320" height="240" controls>
            <source id="video_1_preview" type="video/mp4"
            src=
            {{#if video_1}}
          "{{video_1}}"
          {{else}}
          "#"
          {{/if}}
            >
          </video>
          <div>
          <input type="file" id="video_1" name="video_1" accept="video/mp4" onchange="previewVideo(1)">
          </div>
        </div>

        <div class="pt-4 pb-4"></div>

        <div class="form-group">
          <div>
          <h4 class="font-weight-bold">Radio Music</h4>
          <p class="text-muted">Relaxing music, a favorite song, or a voice message</p>
          </div>
          
          <audio id="music_1_audio" controls>
            <source id="music_1_preview" type="audio/mpeg"
            src=
            {{#if music_1}}
          "{{music_1}}"
          {{else}}
          "#"
          {{/if}}
            >
          </audio>
          <div>
            <input type="file" id="music_1" name="music_1" accept="audio/mpeg" onchange="previewMusic(1)">
          </div>
        </div>

        <div class="pt-4 pb-4"></div>

        <div class="form-group">
          <div>
            <h4 class="font-weight-bold">Picture on the wall</h4>
            <p class="text-muted"></p>
          </div>
          
          <img id="image_1_preview" height="100" length="100"
          src=
          {{#if image_1}}
          "{{image_1}}"
          {{else}}
          "/static/img/default-placeholder-image.png"
          {{/if}}
          >

          <div>
            <input type="file" id="image_1" name="image_1" accept="image/*" onchange="previewImage(1)">
          </div>

        </div>

        <div class="pt-4 pb-4"></div>

        <div class="form-group">
          <div>
            <h4 class="font-weight-bold">Picture on the table</h4>
            <p class="text-muted"></p>
          </div>

          
          
          <img id="image_2_preview" height="100" length="100"
          src=
          {{#if image_2}}
          "{{image_2}}"
          {{else}}
          "/static/img/default-placeholder-image.png"
          {{/if}}
          >

          <div>
            <input type="file" id="image_2" name="image_2" accept="image/*" onchange="previewImage(2)">
          </div>

        </div>
        <div class="pt-4 pb-4"></div>
        <div class="form-group">
          <div>
            <h4 class="font-weight-bold">Patient Name/Alias</h4>
            <p class="text-muted"></p>
          
            <input type="text" id="patient_name" name="patient_name" value={{patient_name}}>
          </div>

          <div>
            <h4 class="font-weight-bold">Patient Age/Alias</h4>
            <p class="text-muted"></p>
          
            <input type="number" id="patient_age" name="patient_age" value={{patient_age}}>
          </div>

          

        </div>
        <div class="text-center">
        <input class="btn btn-lg mt-5 btn-custom w-25 mt-5 mx-auto" type="submit" value="Save Settings">
          </div>
        </div>
      </form>
    </section>


<div class="d-flex justify-content-center mb-5">
  <div class="mr-2">
<form method="POST" action="/room/join" enctype="multipart/form-data">
  <input type="hidden" name="room_code" value={{room_code}}>
  <input class="btn btn-lg btn-custom" type="submit" value="Join Room">
</form>
</div>

  <div class="ml-2">
  <button type="button" class="btn btn-lg btn-danger" data-toggle="modal" data-target="#exampleModal">
    Delete Room
  </button>
  </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Confirm Deletion</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        All data will be deleted <b>permanently</b>. Are you sure you want to delete this room? 
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <form method="POST" action="/room/delete" enctype="multipart/form-data">
            <input type="hidden" name="room_code" value={{room_code}}>
            <input type="hidden" name="secret_key" value={{secret_key}}>
            <input class="btn btn-danger" type="submit" value="Delete">
        </form>
      </div>
    </div>
  </div>
</div>

<script>

  function previewImage(image_no) {
    var file = document.getElementById(`image_${image_no}`).files 
    if (file.length > 0 ) {
      var fileReader = new FileReader()

      fileReader.onload = function(e) {
        document.getElementById(`image_${image_no}_preview`).setAttribute("src", e.target.result)
      }

      fileReader.readAsDataURL(file[0])
    }
  }

  function previewVideo(video_no) {
    var file = document.getElementById(`video_${video_no}`).files[0] 
    var video = document.getElementById(`video_${video_no}_video`)
    var fileReader = new FileReader()

    fileReader.onload = function(e) {
      document.getElementById(`video_${video_no}_preview`).setAttribute("src", e.target.result)
      video.load()
      video.play()
    }
    fileReader.readAsDataURL(file)
  }

  function previewMusic(music_no) {
    var file = document.getElementById(`music_${music_no}`).files[0] 
    var music = document.getElementById(`music_${music_no}_audio`)
    var fileReader = new FileReader()

    fileReader.onload = function(e) {
      document.getElementById(`music_${music_no}_preview`).setAttribute("src", e.target.result)
      music.load()
      music.play()
    }
    fileReader.readAsDataURL(file)
  }

</script>

