{{> header }}
<div class="container p-5 text-center">
  {{#if error}}
    <div class="alert alert-danger">{{ error }}</div>
  {{/if}}

  <h1>EDIT ROOM</h1>
  <hr>

    <div class="row">
      <div class="col">
         <h3 class="font-weight-bold">Room Code {{room_code}} </h3>
         <h5>Name/Alias {{patient_name}}</h5>
         <h5>Age {{patient_age}}</h5>

      
      </div>
      <div class="col">
        <div>
          <form method="POST" action="/room/archive" enctype="multipart/form-data">
            <input type="hidden" name="room_code" value={{room_code}}>
            <input type="hidden" name="secret_key" value={{secret_key}}>
            <input class="btn btn-lg btn-custom" type="submit" value="View Archive">
          </form>
        </div>

      </div>
    </div>


    

    </section>
  
  
    <section id="living-room" class="mt-5">
      <form method="POST" action="/room/edit" enctype="multipart/form-data">
        <input type="hidden" name="room_code" value={{room_code}}>
        <input type="hidden" name="secret_key" value={{secret_key}}>

        <h2 class="font-weight-bold">Metadata</h2>
        <hr>
        <div>
          
            <div class="form-group">
                      <div>
                        <h4 class="font-weight-bold">Patient Name/Alias</h4>
                        <p class="text-muted"></p>
                      
                        <input type="text" id="patient_name" name="patient_name" value={{patient_name}}>
                      </div>

                      <div>
                        <h4 class="font-weight-bold">Patient Age</h4>
                        <p class="text-muted"></p>
                      
                        <input type="number" id="patient_age" name="patient_age" value={{patient_age}}>
                      </div>
                    </div>


        </div>

        <h2 class="font-weight-bold mt-5">Video/Music</h2>
        <hr>
        <div class="row">
          <div class="col">

            <div class="form-group">
          <div>
          <h4 class="font-weight-bold mb-0">Television Clip</h4>
          <p class="text-muted">A short snippet from a favorite show or movie</p>
          </div>

          
          <video id="video_1_video" width="320" height="240" controls>
            <source id="video_1_preview" type="video/mp4"
            src="{{video_1}}">
          </video>
          <div>
          <input type="file" id="video_1" name="video_1" accept="video/mp4" onchange="previewVideo(1)">
          </div>
        </div>

          </div>
          <div class="col">
            <div class="form-group">
                      <div>
                      <h4 class="font-weight-bold">Radio Music</h4>
                      <p class="text-muted">Relaxing music, a favorite song, or a voice message</p>
                      </div>
                      
                      <audio id="music_1_audio" controls>
                        <source id="music_1_preview" type="audio/mpeg"
                        src="{{music_1}}">
                      </audio>
                      <div>
                        <input type="file" id="music_1" name="music_1" accept="audio/mpeg" onchange="previewMusic(1)">
                      </div>
                    </div>
          </div>
        </div>

        

        <div class="pt-4 pb-4"></div>

        

        <div class="pt-4 pb-4"></div>

        <h2 class="font-weight-bold">Pictures</h2>
        <hr>

        <div class="form-group">
          <h4 class="font-weight-bold">Wall</h4>
          <div class="row">
            <div class="col">
              <img id="image_1_preview" height="100" length="100" src="{{wall_1}}">
              <div>
              <input type="file" id="image_1" name="wall_1" accept="image/jpeg" onchange="previewImage(1)">
              </div>
            </div>
            <div class="col">
              <img id="image_2_preview" height="100" length="100" src="{{wall_2}}">
              <div>
                <input type="file" id="image_2" name="wall_2" accept="image/jpeg" onchange="previewImage(2)">
              </div>
            </div>
          </div>

          <h4 class="font-weight-bold mt-3">Movie Poster and Book</h4>
          <div class="row">
            <div class="col">
              <img id="image_3_preview" height="100" length="100" src="{{movie_poster_1}}">
              <div>
                <input type="file" id="image_3" name="movie_poster_1" accept="image/jpeg" onchange="previewImage(3)">
              </div>
            </div>
            <div class="col">
              <img id="image_4_preview" height="100" length="100" src="{{book_cover_1}}">
              <div>
                <input type="file" id="image_4" name="book_cover_1" accept="image/jpeg" onchange="previewImage(4)">
              </div>
            </div>
            
          </div>
          
          <h4 class="font-weight-bold mt-3">Scrapbook</h4>
          <div class="row">
            <div class="col">
              <img id="image_5_preview" height="100" length="100" src="{{scrapbook_1}}">
              <div>
                <input type="file" id="image_5" name="scrapbook_1" accept="image/jpeg" onchange="previewImage(5)">
              </div>

              <img id="image_6_preview" height="100" length="100" src="{{scrapbook_2}}">
              <div>
                <input type="file" id="image_6" name="scrapbook_2" accept="image/jpeg" onchange="previewImage(6)">
              </div>



            </div>
           
            <div class="col">
              <img id="image_7_preview" height="100" length="100" src="{{scrapbook_3}}">
              <div>
                <input type="file" id="image_7" name="scrapbook_3" accept="image/jpeg" onchange="previewImage(7)">
              </div>

              <img id="image_8_preview" height="100" length="100" src="{{scrapbook_4}}">
              <div>
                <input type="file" id="image_8" name="scrapbook_4" accept="image/jpeg" onchange="previewImage(8)">
              </div>
            </div>
                
          </div>


          
        </div>
        
        <div class="text-center">
        <input class="btn btn-lg mt-5 btn-custom mt-5 mx-auto" type="submit" value="Save Settings">
          </div>
        </div>
      </form>
    </section>


<div class="d-flex justify-content-center mb-5">
  <div class="mr-2">
<form method="POST" action="/room/join" enctype="multipart/form-data">
  <input type="hidden" name="room_code" value={{room_code}}>
  <input class="btn btn-lg btn-custom" type="submit" value="Join Room">
</form>
</div>

  <div class="ml-2">
  <button type="button" class="btn btn-lg btn-danger" data-toggle="modal" data-target="#exampleModal">
    Delete Room
  </button>
  </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Confirm Deletion</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        All data will be deleted <b>permanently</b>. Are you sure you want to delete this room? 
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <form method="POST" action="/room/delete" enctype="multipart/form-data">
            <input type="hidden" name="room_code" value={{room_code}}>
            <input type="hidden" name="secret_key" value={{secret_key}}>
            <input class="btn btn-danger" type="submit" value="Delete">
        </form>
      </div>
    </div>
  </div>
</div>

<script>

  function previewImage(image_no) {
    var file = document.getElementById(`image_${image_no}`).files 
    if (file.length > 0 ) {
      var fileReader = new FileReader()

      fileReader.onload = function(e) {
        document.getElementById(`image_${image_no}_preview`).setAttribute("src", e.target.result)
      }

      fileReader.readAsDataURL(file[0])
    }
  }

  function previewVideo(video_no) {
    var file = document.getElementById(`video_${video_no}`).files[0] 
    var video = document.getElementById(`video_${video_no}_video`)
    var fileReader = new FileReader()

    fileReader.onload = function(e) {
      document.getElementById(`video_${video_no}_preview`).setAttribute("src", e.target.result)
      video.load()
      video.play()
    }
    fileReader.readAsDataURL(file)
  }

  function previewMusic(music_no) {
    var file = document.getElementById(`music_${music_no}`).files[0] 
    var music = document.getElementById(`music_${music_no}_audio`)
    var fileReader = new FileReader()

    fileReader.onload = function(e) {
      document.getElementById(`music_${music_no}_preview`).setAttribute("src", e.target.result)
      music.load()
      music.play()
    }
    fileReader.readAsDataURL(file)
  }

</script>

